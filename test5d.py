"""

https://rosettacode.org/wiki/Deconvolution/2D%2B

Working on 5 dimensional example using test data from the
RC task.

Python fft:

https://docs.scipy.org/doc/numpy/reference/routines.fft.html

"""

import numpy
import pprint

h =   [
       [
          [
             [[-4, -5, 6], [-9, -8, 7], [6, 5, 6], [-2, 4, 1]], 
             [[-9, -5, 3], [-9, -9, 6], [4, 1, 9], [1, 9, -2]], 
             [[-3, -8, -4], [-7, -7, 1], [4, -2, -7], [-9, -4, -1]]], 
          [
             [[1, -6, 4], [9, 5, 4], [-2, -9, -7], [-4, -9, 2]], 
             [[-4, 7, -2], [2, -2, -6], [-6, 8, -7], [-5, 9, -2]], 
             [[-5, 5, 1], [2, 7, -2], [1, 4, -3], [7, 6, 8]]], 
          [
             [[5, -3, 4], [2, -4, 7], [-9, -4, -3], [9, 1, -6]], 
             [[7, 8, -6], [-2, 1, -7], [-5, 9, 3], [-8, 6, 7]], 
             [[3, -4, 5], [8, -7, 7], [8, -2, 3], [4, -4, 9]]]],
       [
          [
             [[-6, -1, -4], [-7, 1, -7], [1, 3, 8], [3, 1, 2]], 
             [[-7, 8, -3], [5, 9, -5], [-2, -4, 4], [-9, -9, 7]], 
             [[9, -3, -7], [-3, -6, -9], [-1, -1, -8], [1, 2, -1]]], 
          [
             [[-8, 6, 6], [-1, 3, 7], [-5, -6, 8], [-2, 9, -4]], 
             [[3, 1, -4], [1, 2, -4], [7, -8, -1], [-5, 3, -5]], 
             [[1, 8, -4], [5, 2, -2], [1, 4, 3], [6, -4, 2]]], 
          [
             [[-3, 2, -7], [-4, 1, 8], [5, 5, -8], [3, 1, -9]], 
             [[-3, 5, -6], [-4, -9, -5], [-4, 4, 3], [5, 3, -3]], 
             [[4, -8, 4], [5, -4, -4], [1, 2, 6], [-6, -8, 2]]]], 
       [
          [
             [[7, -6, -8], [-3, -4, 7], [-4, -2, -8], [-9, 2, 2]], 
             [[-1, -5, 6], [8, 3, -8], [9, 5, 3], [-3, -9, 2]], 
             [[3, 6, -9], [6, -7, -2], [3, -6, -7], [-7, 2, -9]]], 
          [
             [[-7, 1, -1], [-4, 8, 5], [9, 5, -4], [-4, -8, 3]], 
             [[-6, -6, 6], [-5, -7, -5], [-4, -6, -6], [2, 8, -8]], 
             [[-4, -6, 6], [9, -2, 1], [7, -6, -1], [1, -5, 6]]], 
          [
             [[-6, 8, 3], [6, -7, -2], [8, 9, 8], [3, 8, -9]], 
             [[6, -7, 7], [7, -9, 4], [7, -6, -9], [-4, 2, -2]], 
             [[-2, 6, 6], [-2, -3, 5], [-6, -6, 1], [4, -4, 3]]]]]
f =   [
       [
          [
             [[9, -2], [-2, 5], [6, 1]], 
             [[7, 3], [-8, 4], [-9, -9]], 
             [[-3, -6], [8, -1], [3, -7]], 
             [[-2, -9], [-9, 4], [-4, -4]]], 
          [
             [[-2, 2], [2, -1], [-8, 6]], 
             [[-5, 4], [8, -2], [-9, 7]], 
             [[2, 1], [-6, -1], [1, 5]], 
             [[-7, 1], [-5, 2], [7, 4]]]], 
       [
          [
             [[-2, -1], [4, -3], [-5, -7]], 
             [[-1, -9], [-7, 7], [-1, -2]], 
             [[4, 1], [2, 8], [-2, 7]], 
             [[-9, 5], [-2, 7], [8, 7]]], 
          [
             [[-2, 4], [4, 2], [-4, 1]], 
             [[8, -7], [-4, -5], [-6, 4]], 
             [[4, 1], [-4, 6], [-4, 5]], 
             [[-8, -2], [5, -8], [9, -8]]]], 
       [
          [
             [[-9, 6], [-9, 3], [-1, -3]], 
             [[2, -7], [2, 8], [-8, -6]], 
             [[-8, 2], [6, 4], [6, 3]], 
             [[-9, 3], [7, -9], [9, 8]]], 
          [
             [[-6, -3], [-1, 2], [-9, 8]], 
             [[4, 2], [-8, -3], [5, -5]], 
             [[9, 2], [-5, -6], [9, 9]], 
             [[-6, 2], [4, -8], [9, -9]]]]]
g =   [
       [
          [
             [
                [-36, -37, 64, -12], 
                [-73, -64, 42, 16], 
                [48, -30, 21, 29], 
                [-84, 3, 48, 35], 
                [40, 18, 59, 11], 
                [-12, 22, 10, 1]], 
             [
                [-109, -74, 64, 12], 
                [-94, -157, -2, 48], 
                [150, 97, -5, 7], 
                [-34, 193, -22, 19], 
                [-16, -142, 13, -51], 
                [24, 37, -48, -11]], 
             [
                [-78, -89, -2, -19], 
                [-53, -92, 42, -40], 
                [111, -10, -59, -46], 
                [-48, 266, 67, -117], 
                [0, -151, -113, -144], 
                [-69, -97, -98, 10]], 
             [
                [14, 50, 2, -84], 
                [-16, 158, 35, -91], 
                [85, 91, -71, -112], 
                [-44, 167, 119, -92], 
                [50, -64, 31, -22], 
                [92, 129, -44, 19]], 
             [
                [27, 133, 99, -3], 
                [96, 110, 37, -44], 
                [32, -7, -17, 0], 
                [36, 126, -117, 36], 
                [-85, -154, 3, 6], 
                [-31, 11, -3, 15]], 
             [
                [6, 43, 80, 36], 
                [41, 137, 65, -25], 
                [67, 47, 43, 83], 
                [10, 179, 117, -23], 
                [65, -8, 29, 24], 
                [36, 52, 20, 4]]], 
          [
             [
                [17, -54, 26, 4], 
                [89, 36, -25, 20], 
                [-28, -66, -68, 79], 
                [110, -24, -57, 3], 
                [-56, -52, -120, 38], 
                [-8, -102, 19, 8]], 
             [
                [9, 33, -88, 46], 
                [94, 29, -52, 55], 
                [-197, 61, -228, 23], 
                [103, -93, -227, -31], 
                [-76, 220, 9, 150], 
                [16, 50, 149, -25]], 
             [
                [-33, 89, -6, -22], 
                [42, -191, -90, -20], 
                [87, 173, 71, 15], 
                [232, -136, 95, 11], 
                [-12, 0, 69, 194], 
                [136, -94, 146, -3]], 
             [
                [0, 66, -26, -28], 
                [119, 41, -243, 50], 
                [-44, 69, -127, 103], 
                [16, -128, -195, 106], 
                [-137, 220, -10, 172], 
                [6, 4, -120, -79]], 
             [
                [80, 44, -134, 11], 
                [98, 10, -6, 74], 
                [9, 117, -270, 65], 
                [-90, -300, -103, 34], 
                [209, -32, 159, 31], 
                [39, -29, -45, -61]], 
             [
                [31, 88, -27, -13], 
                [105, -21, -58, 15], 
                [-14, -101, -40, -6], 
                [-37, -183, -34, -87], 
                [6, -42, -112, 14], 
                [-91, -116, -79, -36]]], 
          [
             [
                [43, -23, 22, 0], 
                [-8, -14, 64, 10], 
                [-41, 56, -101, 51], 
                [43, -60, -61, 39], 
                [-64, 56, 10, -77], 
                [86, 63, -105, 6]], 
             [
                [101, 64, -77, 36], 
                [-107, 41, 21, 19], 
                [-2, 107, -93, -92], 
                [-52, 80, -58, -82], 
                [19, 68, 283, -52], 
                [-53, -111, 82, 63]], 
             [
                [93, -68, 89, -54], 
                [-14, 21, 121, -105], 
                [117, -415, 261, 33], 
                [-79, -113, 415, 90], 
                [236, -56, -104, -32], 
                [108, -213, -82, 32]], 
             [
                [0, -116, -4, 21], 
                [-45, 111, -123, 40], 
                [-31, 199, -187, 67], 
                [9, 201, 35, -3], 
                [-151, 91, 15, -125], 
                [-192, -66, -55, -52]], 
             [
                [-5, -133, -23, 23], 
                [-19, -126, 212, -21], 
                [38, -259, 207, -114], 
                [234, -265, 151, -168], 
                [90, -257, -14, -69], 
                [16, 52, 63, -59]], 
             [
                [29, -59, 24, -44], 
                [-32, -92, 14, -43], 
                [-152, -12, -7, -22], 
                [-152, 22, -30, -103], 
                [-96, 44, -134, 28], 
                [33, 70, 60, -4]]], 
          [
             [
                [-10, 16, -14, 8], 
                [6, 1, -11, 10], 
                [-18, 34, -34, 11], 
                [-52, 61, -68, 33], 
                [90, -29, -13, -12], 
                [-72, 46, 54, -36]], 
             [
                [-39, 33, -4, 4], 
                [48, -3, -17, 12], 
                [-34, -36, 99, -21], 
                [-113, 42, -16, 0], 
                [177, -119, -13, 2], 
                [-17, -42, 41, 0]], 
             [
                [-31, 1, 49, -10], 
                [30, 63, -50, -4], 
                [-103, -1, -39, 23], 
                [36, 155, -53, 62], 
                [-138, -64, 78, 7], 
                [49, -8, -118, 73]], 
             [
                [-36, 81, -76, 18], 
                [-101, 29, -79, 32], 
                [94, 121, 54, 40], 
                [-20, 53, -71, 64], 
                [-105, -61, 34, -13], 
                [19, 73, -110, 74]], 
             [
                [-43, -54, 56, -1], 
                [-23, -20, 77, -17], 
                [65, 56, -31, -14], 
                [35, -73, -115, 26], 
                [-11, 55, -23, 32], 
                [-52, 26, 62, 73]], 
             [
                [-21, 31, -39, 5], 
                [-71, 83, -89, 17], 
                [-75, 57, -53, 37], 
                [-12, 41, -65, 43], 
                [36, 46, -40, 30], 
                [28, -12, 47, 36]]]], 
       [
          [
             [
                [-46, 17, -41, 2], 
                [-49, 12, -29, -31], 
                [-41, 8, 100, -124], 
                [56, 100, -2, -39], 
                [-38, -13, -21, -27], 
                [28, 3, -20, -5]], 
             [
                [-83, 121, -36, -63], 
                [77, 120, -23, -78], 
                [109, 87, 159, -69], 
                [57, 172, 77, 54], 
                [-35, -144, -232, -87], 
                [-84, -151, -56, 1]], 
             [
                [49, 110, 41, 12], 
                [49, 3, -14, 35], 
                [44, -115, -251, 61], 
                [-50, -28, -208, 246], 
                [26, 43, 69, -9], 
                [144, 207, 56, -60]], 
             [
                [99, 111, -76, 102], 
                [-33, 56, -206, 95], 
                [42, -173, -140, 198], 
                [33, 150, 207, 243], 
                [-3, 3, 300, 112], 
                [-57, 22, 175, -53]], 
             [
                [56, -33, -103, 80], 
                [199, -252, -217, 114], 
                [-89, -363, -241, 143], 
                [-107, -162, -110, 95], 
                [98, 65, -14, 61], 
                [65, 95, 12, -42]], 
             [
                [9, -18, 37, 43], 
                [-6, 125, 31, 30], 
                [-53, -53, 36, 8], 
                [36, -54, 60, -34], 
                [45, -49, -43, -28], 
                [-76, -107, -40, -3]]], 
          [
             [
                [-54, 65, 14, 0], 
                [-3, -129, 73, 30], 
                [-56, -34, 165, 35], 
                [57, -9, -21, 23], 
                [-66, -55, 178, 85], 
                [-8, 117, 28, -5]], 
             [
                [8, -79, 164, -60], 
                [-87, -59, -37, -39], 
                [265, -166, -136, 109], 
                [61, 228, -154, -122], 
                [126, 67, -182, 62], 
                [70, -80, -203, 99]], 
             [
                [-5, 68, -89, -80], 
                [-84, 32, 153, -63], 
                [286, 394, -25, -102], 
                [41, -162, -330, -93], 
                [-157, -144, 130, -8], 
                [167, -92, -249, 86]], 
             [
                [-51, 258, -132, -49], 
                [298, -234, 48, -46], 
                [-127, -127, 87, -149], 
                [57, 4, -315, -126], 
                [3, -54, 52, -144], 
                [-55, -212, -15, 31]], 
             [
                [134, -164, -1, 31], 
                [-97, 1, 208, -74], 
                [-96, 13, 260, -245], 
                [67, 20, 229, -272], 
                [127, -64, 198, -165], 
                [-33, -20, 31, 82]], 
             [
                [4, 5, 46, 42], 
                [-10, -89, 276, 6], 
                [-113, -51, 287, -57], 
                [-84, -119, 68, 4], 
                [-85, 99, -103, 61], 
                [-42, 143, 138, 52]]], 
          [
             [
                [-23, 13, -104, 38], 
                [-42, -7, 123, -38], 
                [144, -17, -129, 32], 
                [-105, -82, -76, -24], 
                [133, 136, -112, 35], 
                [5, -111, 39, 11]], 
             [
                [-17, -152, 30, -59], 
                [-46, -8, 115, -98], 
                [36, -58, -272, 203], 
                [-1, -281, 223, -70], 
                [-169, 371, 10, -40], 
                [136, -158, 110, -11]], 
             [
                [-20, -87, 4, 73], 
                [85, -67, -114, 53], 
                [-151, 48, 48, 146], 
                [96, 63, 12, -5], 
                [138, -162, -246, 3], 
                [-89, -151, -11, -60]], 
             [
                [16, 114, -87, 49], 
                [-18, 203, -257, -110], 
                [57, -33, 54, 55], 
                [-289, -108, 604, -60], 
                [-89, -517, 201, -15], 
                [10, 76, 133, 7]], 
             [
                [-64, -53, 153, 2], 
                [68, -72, 453, 33], 
                [230, 106, 28, -37], 
                [227, -17, 33, 212], 
                [-178, 173, -46, 199], 
                [-212, 173, -19, 156]], 
             [
                [-2, -54, 17, -17], 
                [-205, 141, -141, 108], 
                [-195, 279, -162, 10], 
                [-50, 215, -288, 161], 
                [127, 178, -166, 44], 
                [161, 46, 90, -1]]], 
          [
             [
                [-4, 16, -2, 2], 
                [18, 11, -50, 59], 
                [12, -51, 100, -60], 
                [-26, -5, -95, 15], 
                [38, 18, 61, -54], 
                [-60, 15, 103, -60]], 
             [
                [47, -85, 162, -92], 
                [26, 1, -28, -67], 
                [-142, -104, 274, -128], 
                [175, 78, -102, 109], 
                [27, -157, 82, 18], 
                [-89, 16, 148, -98]], 
             [
                [71, 16, -103, 43], 
                [-56, 81, -115, 143], 
                [-112, 83, -152, 49], 
                [-51, 266, -79, -72], 
                [89, -78, 13, -23], 
                [2, 45, -49, -47]], 
             [
                [7, 46, 18, -46], 
                [85, -234, 194, -192], 
                [77, -20, 189, -169], 
                [-202, -73, 404, -136], 
                [-119, -170, 7, 102], 
                [169, -10, -251, 82]], 
             [
                [-15, -141, 95, 15], 
                [100, 63, -25, 74], 
                [84, 146, -329, 167], 
                [-83, 53, -371, 39], 
                [-149, 371, -70, 23], 
                [-59, 157, -88, -13]], 
             [
                [-52, 86, -68, -6], 
                [-104, 77, 3, -50], 
                [-1, -182, 116, -88], 
                [152, -143, -6, -100], 
                [129, -88, 144, -68], 
                [-6, -148, 95, -64]]]], 
       [
          [
             [
                [111, -39, -135, 56], 
                [66, 87, -123, 25], 
                [43, 72, -281, 123], 
                [-85, 1, 97, -11], 
                [13, -157, -118, -75], 
                [-67, -21, -16, -15]], 
             [
                [133, -9, -9, -21], 
                [144, 162, -162, 128], 
                [185, 45, -229, -4], 
                [25, 106, 36, -22], 
                [55, -97, 87, -19], 
                [120, 75, -66, -69]], 
             [
                [5, 167, -104, 81], 
                [325, -205, -217, -46], 
                [-63, -135, 288, -44], 
                [-25, 147, 111, 165], 
                [40, 18, -121, 125], 
                [-55, 182, 1, -16]], 
             [
                [129, 7, 43, 101], 
                [1, 17, 308, -203], 
                [-302, -413, 73, 196], 
                [-95, -40, 302, -82], 
                [131, -87, 431, 299], 
                [191, 210, 147, 132]], 
             [
                [197, -51, 34, -21], 
                [30, -7, -136, -17], 
                [-386, -240, -35, -166], 
                [81, -264, -57, -65], 
                [-37, -52, -265, 132], 
                [-128, 9, 32, 78]], 
             [
                [-60, 96, 24, 34], 
                [12, 39, 230, -73], 
                [-97, 18, 63, -123], 
                [-22, -118, -92, 5], 
                [14, 21, 36, -118], 
                [-45, -65, -7, 21]]], 
          [
             [
                [-34, 125, -114, -30], 
                [-74, 161, -101, -27], 
                [-22, 124, -207, -94], 
                [103, 76, -116, 25], 
                [87, 225, -89, 6], 
                [68, -185, 4, 47]], 
             [
                [-92, -16, 137, -106], 
                [142, -139, -134, 57], 
                [342, 211, 206, -97], 
                [38, -691, -497, -70], 
                [-205, -284, 108, 84], 
                [216, 238, -36, 22]], 
             [
                [-204, 42, -7, 103], 
                [-9, -208, -58, 41], 
                [234, 3, 333, -104], 
                [-71, 437, 177, -53], 
                [42, -294, 254, 2], 
                [144, -294, 12, 37]], 
             [
                [57, -106, -69, 80], 
                [50, 47, 153, 93], 
                [24, 11, 388, -81], 
                [-452, -402, 318, -92], 
                [-76, 234, -194, 57], 
                [-121, -37, -64, -167]], 
             [
                [209, -48, -28, -124], 
                [-290, 192, 224, -17], 
                [-191, 488, 238, -316], 
                [68, 92, -75, -232], 
                [243, 285, 363, -293], 
                [-245, -90, 106, -112]], 
             [
                [-31, -70, 263, -74], 
                [-40, 0, 196, 50], 
                [-165, 171, 249, 90], 
                [-112, 147, -26, 142], 
                [69, 106, -145, 64], 
                [-14, 177, 51, 35]]], 
          [
             [
                [-69, 113, -21, 35], 
                [-92, -78, -171, 133], 
                [133, 258, 44, 95], 
                [70, 73, -64, 26], 
                [-89, 164, 164, -42], 
                [70, 48, -142, 102]], 
             [
                [-27, -61, 247, -36], 
                [147, -84, 241, -229], 
                [199, -377, -71, 158], 
                [221, -182, 8, 26], 
                [129, -225, 26, -256], 
                [-66, -425, 274, 59]], 
             [
                [9, 82, -266, 168], 
                [-33, 219, 258, 135], 
                [-77, -434, -603, 7], 
                [-407, -6, 474, 285], 
                [-58, 189, -306, -197], 
                [62, -33, -161, -25]], 
             [
                [-25, 95, -47, -116], 
                [199, -448, -33, -125], 
                [-28, -257, -49, -607], 
                [-96, 160, 304, -72], 
                [-302, -44, -46, -128], 
                [-154, 261, -62, -193]], 
             [
                [-57, -123, 137, -119], 
                [158, 391, -163, -6], 
                [-98, 252, -106, 169], 
                [-43, -21, 14, 48], 
                [-190, 188, -48, 110], 
                [-4, 399, 14, 201]], 
             [
                [-9, 75, -227, -3], 
                [-192, 172, -207, 0], 
                [-77, 71, -271, 71], 
                [241, 176, -449, 91], 
                [228, 47, -24, -62], 
                [96, -234, 103, 10]]], 
          [
             [
                [-12, -41, 17, -34], 
                [-45, 63, -88, -2], 
                [37, -1, 84, 68], 
                [-71, 129, -83, -14], 
                [6, -35, -30, -5], 
                [-117, 16, 219, -111]], 
             [
                [-22, -94, -27, 77], 
                [-131, 209, 78, -55], 
                [34, -304, -84, -57], 
                [168, 185, 30, -22], 
                [-182, -49, 118, 103], 
                [84, -250, 188, -28]], 
             [
                [-27, 195, -194, 75], 
                [-79, -204, 71, 7], 
                [-81, 203, -51, 158], 
                [95, 297, -593, 175], 
                [-268, -20, -55, -49], 
                [-6, 300, -83, -113]], 
             [
                [153, -89, 53, 20], 
                [-40, -102, -204, 19], 
                [-111, 209, 235, -125], 
                [-322, -88, 214, -125], 
                [190, 77, -39, 137], 
                [53, 6, -65, 112]], 
             [
                [-21, -61, 97, 27], 
                [47, 170, -213, 113], 
                [53, 161, -195, 262], 
                [18, -20, -47, 179], 
                [23, 252, -316, -106], 
                [9, 129, -68, 59]], 
             [
                [-36, 42, -90, 8], 
                [-32, -47, 64, -33], 
                [102, -228, 225, -72], 
                [166, -152, 83, -64], 
                [5, -158, 185, -153], 
                [10, -108, 204, -85]]]], 
       [
          [
             [
                [40, -22, 52, -16], 
                [151, -94, 78, -37], 
                [21, -50, 159, 82], 
                [-12, 55, -110, 30], 
                [-44, 67, 24, 32], 
                [42, 43, -29, -20]], 
             [
                [46, -120, 129, 76], 
                [-74, -52, 208, -151], 
                [53, -2, -60, 46], 
                [200, 80, -56, 118], 
                [91, -122, -155, -20], 
                [9, 92, 45, -51]], 
             [
                [-24, 124, 26, -82], 
                [-37, -18, -65, -8], 
                [-94, -117, 87, -155], 
                [-229, -109, 259, 75], 
                [-27, -53, 0, 129], 
                [145, 123, 65, 40]], 
             [
                [58, -121, 96, 78], 
                [-33, 66, 109, -26], 
                [-84, 203, -279, 61], 
                [66, 181, 76, -101], 
                [-18, -242, 192, 72], 
                [-94, -108, 5, 89]], 
             [
                [12, 16, -8, -2], 
                [-56, 143, 40, -106], 
                [-53, 56, -180, -125], 
                [119, 364, -329, -220], 
                [-23, 54, 47, -145], 
                [-85, -284, -24, 4]], 
             [
                [-108, 15, 165, -66], 
                [30, 45, 84, -37], 
                [54, 230, -69, -111], 
                [62, -125, -163, -111], 
                [36, -92, -171, -167], 
                [-47, -7, -51, -71]]], 
          [
             [
                [108, -33, 2, 17], 
                [143, -108, -139, 83], 
                [86, 3, -155, -49], 
                [186, -177, -136, -94], 
                [-70, -194, 88, 47], 
                [31, 63, 2, 9]], 
             [
                [52, 23, -80, 18], 
                [-90, -159, 355, -124], 
                [77, 163, 129, 12], 
                [-123, 327, 46, 47], 
                [141, 98, -34, -32], 
                [177, -102, -180, 145]], 
             [
                [-75, -138, 176, -124], 
                [-23, 166, 62, 56], 
                [-93, 67, 266, 83], 
                [-198, -294, -22, -130], 
                [-196, 72, 486, -186], 
                [78, 34, 94, -9]], 
             [
                [66, -5, -28, 42], 
                [157, -287, -229, 185], 
                [-330, -143, 170, 171], 
                [-292, 313, 414, -75], 
                [-25, 339, -350, 47], 
                [-209, -131, 54, -98]], 
             [
                [146, -68, -82, -25], 
                [-124, -164, 72, 20], 
                [42, 274, -508, 9], 
                [196, 4, -371, -173], 
                [36, -17, 4, -290], 
                [-66, 3, 213, -181]], 
             [
                [-51, -53, 72, 22], 
                [-90, 87, -174, 191], 
                [30, -19, -43, 260], 
                [135, 89, -94, 226], 
                [92, -32, -147, 249], 
                [8, 62, -125, 139]]], 
          [
             [
                [101, -88, 13, -67], 
                [21, -81, -23, 29], 
                [129, -132, -17, 5], 
                [14, -109, 119, -10], 
                [-65, -148, -167, 26], 
                [16, -140, 83, 61]], 
             [
                [-79, 54, -20, 34], 
                [128, -110, 190, -184], 
                [61, -121, -195, -62], 
                [-24, -131, 110, -17], 
                [-236, 51, 316, -151], 
                [39, -50, 43, 79]], 
             [
                [-178, 58, 90, -17], 
                [-180, 177, 71, -25], 
                [-79, -144, 112, 161], 
                [-141, 729, 201, 135], 
                [197, 18, 78, 27], 
                [-135, 170, 16, -101]], 
             [
                [218, -276, 221, -131], 
                [130, 21, -348, 163], 
                [-285, 251, -514, -229], 
                [-173, 130, 222, -207], 
                [81, 375, -34, -217], 
                [50, 218, -41, -235]], 
             [
                [-44, 239, -59, 9], 
                [20, 332, -84, 212], 
                [-83, 183, 29, 216], 
                [81, -165, -153, 52], 
                [17, -81, -227, 238], 
                [-8, 196, -326, 146]], 
             [
                [8, 30, -80, 22], 
                [-113, -28, 104, -3], 
                [80, -139, -47, 172], 
                [187, -70, -204, -37], 
                [12, -210, 228, -25], 
                [41, -267, 98, -29]]], 
          [
             [
                [30, -43, 62, 33], 
                [-9, 56, -36, -40], 
                [33, -136, 100, 15], 
                [15, 31, 106, 53], 
                [-68, 10, 80, -92], 
                [-39, -14, 133, -81]], 
             [
                [-54, 125, -77, 11], 
                [117, -26, 108, 69], 
                [158, -27, -68, -127], 
                [-74, 30, -245, -66], 
                [-72, -116, 28, 149], 
                [-32, -45, 97, -17]], 
             [
                [-35, -30, 64, -60], 
                [29, -236, 245, 71], 
                [28, 262, -333, 32], 
                [-182, 270, -106, 209], 
                [-63, 130, 85, -5], 
                [102, 25, -104, -100]], 
             [
                [63, -15, -11, -59], 
                [-103, 111, -260, 39], 
                [-272, 183, 23, -13], 
                [54, -214, -170, -161], 
                [144, 90, -178, 93], 
                [61, 104, -201, 118]], 
             [
                [-2, -34, 54, -12], 
                [11, 5, 38, -17], 
                [26, -232, 270, 163], 
                [82, -349, -16, 25], 
                [74, 113, -64, 150], 
                [-61, -58, -174, 76]], 
             [
                [-8, 12, -100, -4], 
                [-8, 44, 44, -98], 
                [70, -43, 151, -82], 
                [5, -14, 86, -62], 
                [-49, -33, 212, -102], 
                [-18, -86, 149, -42]]]], 
       [
          [
             [
                [-63, 96, 36, -48], 
                [-36, 93, -33, 18], 
                [56, 6, 11, -3], 
                [120, -53, 65, -33], 
                [85, -31, 2, 30], 
                [9, 25, -8, -6]], 
             [
                [23, -22, -58, 92], 
                [-55, 120, -1, -143], 
                [-222, 12, 173, 136], 
                [-64, 99, -159, -75], 
                [32, 12, 33, 61], 
                [75, 56, -3, -18]], 
             [
                [-85, 23, 216, -112], 
                [-1, 4, -126, 47], 
                [14, 158, -4, -154], 
                [8, -90, 282, -18], 
                [-96, -226, -44, -24], 
                [-23, 94, 59, 21]], 
             [
                [-49, 104, -64, 51], 
                [24, -140, 84, 43], 
                [42, -63, 6, -72], 
                [96, 176, -90, 145], 
                [-101, 14, 7, -95], 
                [-43, -91, 79, 76]], 
             [
                [-15, 0, 15, 0], 
                [-109, 87, 140, -118], 
                [-4, -41, -113, 80], 
                [272, 39, -140, -137], 
                [36, 38, 56, -51], 
                [-69, -114, -102, -11]], 
             [
                [-27, -45, 99, -27], 
                [-33, 96, -120, 75], 
                [42, 38, 61, -75], 
                [138, -123, 18, 20], 
                [-22, 47, -192, 25], 
                [-63, -38, -65, -72]]], 
          [
             [
                [21, -36, 81, 18], 
                [110, -73, -19, -10], 
                [-74, 77, 106, -32], 
                [44, 55, -162, 25], 
                [72, -6, -4, -39], 
                [85, -70, 19, 7]], 
             [
                [74, 92, -164, 9], 
                [-38, 25, 16, 19], 
                [143, 20, -116, 31], 
                [-17, 184, 443, -205], 
                [-120, -139, 5, 104], 
                [12, 186, -82, 12]], 
             [
                [121, -69, -60, 15], 
                [-138, 22, 10, 129], 
                [-290, 207, 119, -231], 
                [-130, 272, -126, 220], 
                [108, 243, -24, -186], 
                [-74, -301, 207, -25]], 
             [
                [64, 55, 62, -55], 
                [124, -200, -87, 128], 
                [-56, -94, 99, 45], 
                [-74, -240, 7, -94], 
                [82, 356, 158, 78], 
                [-175, 20, -197, 9]], 
             [
                [119, 164, -247, 24], 
                [-106, -71, 215, -57], 
                [-86, -94, 67, 28], 
                [99, -168, -325, 59], 
                [157, -132, -260, -7], 
                [-66, -38, 49, -145]], 
             [
                [18, 12, -6, 0], 
                [-133, 93, -5, 17], 
                [-3, -113, -35, 119], 
                [229, -194, 94, 91], 
                [69, -59, -31, 73], 
                [-54, 44, -85, 129]]], 
          [
             [
                [96, -93, 24, 21], 
                [31, -42, -78, -20], 
                [-107, -80, -11, 47], 
                [-54, -153, 146, -1], 
                [-112, -69, 127, -77], 
                [33, 23, -106, 51]], 
             [
                [-58, 201, -175, 1], 
                [-41, 204, 15, 123], 
                [60, 232, -320, -115], 
                [-131, 38, 193, 53], 
                [82, -51, -36, -152], 
                [-58, -148, 211, -19]], 
             [
                [15, -191, 24, -15], 
                [-45, 126, -40, 81], 
                [7, 81, -318, 52], 
                [-166, 315, 124, 22], 
                [-27, 415, 178, 36], 
                [11, 32, -236, 91]], 
             [
                [-26, -114, -41, 3], 
                [-75, 330, -108, -28], 
                [-324, -164, 125, 80], 
                [221, -140, -249, -208], 
                [213, 57, -194, 121], 
                [-42, 128, 131, -225]], 
             [
                [-38, -9, -126, 57], 
                [90, 157, 162, -109], 
                [-4, -160, 385, 53], 
                [50, -250, 132, 236], 
                [53, 16, -330, 34], 
                [15, -8, -131, 119]], 
             [
                [42, -32, -84, 30], 
                [-66, 119, -4, -85], 
                [-20, 23, 259, -58], 
                [7, -130, 68, 51], 
                [41, -311, 127, -58], 
                [45, -58, 94, -30]]], 
          [
             [
                [36, -30, -42, -9], 
                [-30, 4, 46, 12], 
                [0, -179, -50, -4], 
                [-80, 61, 2, 27], 
                [-75, -19, 25, 46], 
                [-27, -48, 145, -72]], 
             [
                [-60, 44, 7, -15], 
                [24, -10, -88, -11], 
                [-149, 309, -7, 98], 
                [-68, 34, -191, -12], 
                [-43, 32, 82, -89], 
                [51, -25, -51, 29]], 
             [
                [-18, 14, 3, 2], 
                [78, -25, -147, -38], 
                [46, 73, 253, 45], 
                [4, -60, -177, -48], 
                [174, 44, 77, 191], 
                [-29, 197, -88, -47]], 
             [
                [82, -91, 83, 32], 
                [-19, 8, -81, -70], 
                [-14, 0, -125, -17], 
                [114, -154, 151, 0], 
                [105, 60, -223, -83], 
                [11, -13, -118, 48]], 
             [
                [-54, 104, 10, 26], 
                [-26, -57, 15, -74], 
                [-22, -162, 354, -87], 
                [163, -251, 213, 77], 
                [-27, -189, -87, 88], 
                [0, 54, -45, 45]], 
             [
                [12, -40, -24, 12], 
                [4, 54, -60, -38], 
                [10, 100, 26, -92], 
                [-66, 47, 98, -47], 
                [-38, -48, 107, -33], 
                [36, -72, 63, -27]]]]]
      
def trim_zero_empty(x):
    """
    
    Takes a structure that represents an n dimensional example. 
    For a 2 dimensional example it will be a list of lists.
    For a 3 dimensional one it will be a list of list of lists.
    etc.
    
    Actually these are multidimensional numpy arrays but I was thinking
    in terms of lists.
    
    Returns the same structure without trailing zeros in the inner
    lists and leaves out inner lists with all zeros.
    
    """
    
    if len(x) > 0:
        if type(x[0]) != numpy.ndarray:
            # x is 1d array
            return list(numpy.trim_zeros(x))
        else:
            # x is a multidimentional array
            new_x = []
            for l in x:
               tl = trim_zero_empty(l)
               if len(tl) > 0:
                   new_x.append(tl)
            return new_x
    else:
        # x is empty list
        return x
       
def deconv(a, b):
    """
    
    Returns function c such that b * c = a.
    
    https://en.wikipedia.org/wiki/Deconvolution
    
    """
        
    # Convert larger polynomial using fft

    ffta = numpy.fft.fftn(a)
    
    # Get it's shape so fftn will expand
    # smaller polynomial to fit.
    
    ashape = numpy.shape(a)
    
    # Convert smaller polynomial with fft
    # using the shape of the larger one

    fftb = numpy.fft.fftn(b,ashape)
    
    # Divide the two in frequency domain
    
    fftquotient = ffta / fftb
    
    # Convert back to polynomial coefficients using ifft
    # Should give c but with some small extra components

    c = numpy.fft.ifftn(fftquotient)
    
    # Get rid of imaginary part and round up to 6 decimals
    # to get rid of small real components

    trimmedc = numpy.around(numpy.real(c),decimals=6)
    
    # Trim zeros and eliminate
    # empty rows of coefficients
    
    cleanc = trim_zero_empty(trimmedc)
                
    return cleanc
    
print("deconv(g,h)=")

pprint.pprint(deconv(g,h))

print(" ")

print("deconv(g,f)=")

pprint.pprint(deconv(g,f))